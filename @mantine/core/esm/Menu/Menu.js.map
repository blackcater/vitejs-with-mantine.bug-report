{"version":3,"file":"Menu.js","sources":["../../src/Menu/Menu.tsx"],"sourcesContent":["import React, { useState, useRef, cloneElement } from 'react';\nimport { DefaultProps, MantineNumberSize } from '@mantine/theme';\nimport { useId, useClickOutside, useMergedRef } from '@mantine/hooks';\nimport { ActionIcon } from '../ActionIcon/ActionIcon';\nimport { MantineTransition } from '../Transition/Transition';\nimport { MenuIcon } from './MenuIcon';\nimport { MenuBody, MenuBodyProps } from './MenuBody/MenuBody';\nimport { sizes } from './MenuBody/MenuBody.styles';\nimport { MenuItem, MenuItemProps } from './MenuItem/MenuItem';\n\nexport { MenuBody, MenuItem };\nexport type { MenuBodyProps, MenuItemProps };\n\nexport const MENU_SIZES = sizes;\n\ninterface MenuPosition {\n  top?: React.CSSProperties['top'];\n  bottom?: React.CSSProperties['bottom'];\n  left?: React.CSSProperties['left'];\n  right?: React.CSSProperties['right'];\n}\n\nexport interface MenuProps extends DefaultProps, React.ComponentPropsWithoutRef<'div'> {\n  /** <MenuItem /> and <Divider /> components only, children are passed to MenuBody component  */\n  children: React.ReactNode;\n\n  /** React element that will be used as menu control */\n  control?: React.ReactElement;\n\n  /** Use opened and onClose props to setup controlled menu */\n  opened?: boolean;\n\n  /** Called every time menu is closed */\n  onClose?(): void;\n\n  /** Called every time menu is opened */\n  onOpen?(): void;\n\n  /** Menu button aria-label and title props */\n  menuButtonLabel?: string;\n\n  /** MenuBody component props */\n  menuBodyProps?: Record<string, any>;\n\n  /** Transition styles */\n  transition?: MantineTransition;\n\n  /** Transitions duration in ms */\n  transitionDuration?: number;\n\n  /** Transition timing function */\n  transitionTimingFunction?: string;\n\n  /** Predefined menu width or number for width in px */\n  size?: MantineNumberSize;\n\n  /** Predefined shadow from theme or box-shadow value */\n  shadow?: string;\n\n  /** Should menu close on item click */\n  closeOnItemClick?: boolean;\n\n  /** Id attribute of menu */\n  menuId?: string;\n\n  /** Menu dropdown position */\n  menuPosition?: MenuPosition;\n\n  /** Control prop to get element ref */\n  controlRefProp?: string;\n\n  /** Menu body z-index */\n  zIndex?: number;\n\n  /** Get control ref */\n  elementRef?: React.ForwardedRef<HTMLButtonElement>;\n}\n\nconst defaultControl = (\n  <ActionIcon>\n    <MenuIcon />\n  </ActionIcon>\n);\n\nexport function Menu({\n  control = defaultControl,\n  children,\n  onClose,\n  onOpen,\n  opened,\n  themeOverride,\n  menuPosition = { top: 0, left: 0 },\n  style,\n  menuId,\n  menuBodyProps = {},\n  closeOnItemClick = true,\n  transitionDuration = 250,\n  size = 'md',\n  shadow = 'md',\n  transition = 'skew-up',\n  transitionTimingFunction,\n  menuButtonLabel,\n  controlRefProp = 'elementRef',\n  zIndex = 1000,\n  elementRef,\n  ...others\n}: MenuProps) {\n  const controlRefFocusTimeout = useRef<number>();\n  const controlRef = useRef<HTMLButtonElement>(null);\n  const uuid = useId(menuId);\n  const controlled = typeof opened === 'boolean';\n  const [_opened, setOpened] = useState(false);\n  const menuOpened = controlled ? opened : _opened;\n\n  const handleClose = () => {\n    setOpened(false);\n    typeof onClose === 'function' && onClose();\n    controlRefFocusTimeout.current = window.setTimeout(() => {\n      typeof controlRef.current?.focus === 'function' && controlRef.current.focus();\n    }, transitionDuration + 10);\n  };\n\n  const handleOpen = () => {\n    setOpened(true);\n    window.clearTimeout(controlRefFocusTimeout.current);\n    typeof onOpen === 'function' && onOpen();\n  };\n\n  const wrapperRef = useClickOutside(() => menuOpened && handleClose());\n\n  const toggleMenu = () => (opened || _opened ? handleClose() : handleOpen());\n\n  const menuControl = cloneElement(control, {\n    onClick: toggleMenu,\n    role: 'button',\n    'aria-haspopup': 'menu',\n    'aria-expanded': menuOpened,\n    'aria-controls': uuid,\n    'aria-label': menuButtonLabel,\n    'data-mantine-menu': true,\n    title: menuButtonLabel,\n    [controlRefProp]: useMergedRef(controlRef, elementRef),\n  });\n\n  return (\n    <div\n      ref={wrapperRef}\n      style={{ display: 'inline-block', position: 'relative', ...style }}\n      {...others}\n    >\n      {menuControl}\n\n      <MenuBody\n        {...menuBodyProps}\n        opened={menuOpened}\n        onClose={handleClose}\n        id={uuid}\n        themeOverride={themeOverride}\n        closeOnClickOutside={false}\n        closeOnItemClick={closeOnItemClick}\n        style={{ ...menuBodyProps.style, ...menuPosition }}\n        transitionDuration={transitionDuration}\n        transition={transition}\n        transitionTimingFunction={transitionTimingFunction}\n        size={size}\n        shadow={shadow}\n        zIndex={zIndex}\n      >\n        {children}\n      </MenuBody>\n    </div>\n  );\n}\n\nMenu.displayName = '@mantine/core/Menu';\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAaa,aAAa;AAiE1B,MAAM,qDACH,YAAD,0CACG,UAAD;cAIiB,IAsBP;AAtBO,eACnB;AAAA,cAAU;AAAA,IACV;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,eAAe,CAAE,KAAK,GAAG,MAAM;AAAA,IAC/B;AAAA,IACA;AAAA,IACA,gBAAgB;AAAA,IAChB,mBAAmB;AAAA,IACnB,qBAAqB;AAAA,IACrB,OAAO;AAAA,IACP,SAAS;AAAA,IACT,aAAa;AAAA,IACb;AAAA,IACA;AAAA,IACA,iBAAiB;AAAA,IACjB,SAAS;AAAA,IACT;AAAA,MApBmB,IAqBhB,mBArBgB,IAqBhB;AAAA,IApBH;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAGA,QAAM,yBAAyB;AAC/B,QAAM,aAAa,OAA0B;AAC7C,QAAM,OAAO,MAAM;AACnB,QAAM,aAAa,OAAO,WAAW;AACrC,QAAM,CAAC,SAAS,aAAa,SAAS;AACtC,QAAM,aAAa,aAAa,SAAS;AAEzC,QAAM,cAAc,MAAM;AACxB,cAAU;AACV,WAAO,YAAY,cAAc;AACjC,2BAAuB,UAAU,OAAO,WAAW,MAAM;AArH7D;AAsHM,gCAAkB,YAAX,oBAAoB,WAAU,cAAc,WAAW,QAAQ;AAAA,OACrE,qBAAqB;AAAA;AAG1B,QAAM,aAAa,MAAM;AACvB,cAAU;AACV,WAAO,aAAa,uBAAuB;AAC3C,WAAO,WAAW,cAAc;AAAA;AAGlC,QAAM,aAAa,gBAAgB,MAAM,cAAc;AAEvD,QAAM,aAAa,MAAO,UAAU,UAAU,gBAAgB;AAE9D,QAAM,cAAc,aAAa,SAAS;AAAA,IACxC,SAAS;AAAA,IACT,MAAM;AAAA,IACN,iBAAiB;AAAA,IACjB,iBAAiB;AAAA,IACjB,iBAAiB;AAAA,IACjB,cAAc;AAAA,IACd,qBAAqB;AAAA,IACrB,OAAO;AAAA,KACN,iBAAiB,aAAa,YAAY;AAAA;AAG7C,6CACG,OAAD;AAAA,IACE,KAAK;AAAA,IACL,OAAO,gBAAE,SAAS,gBAAgB,UAAU,aAAe;AAAA,KACvD,SAEH,iDAEA,UAAD,iCACM,gBADN;AAAA,IAEE,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,IAAI;AAAA,IACJ;AAAA,IACA,qBAAqB;AAAA,IACrB;AAAA,IACA,OAAO,kCAAK,cAAc,QAAU;AAAA,IACpC;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MAEC;AAAA;AAMT,KAAK,cAAc;;;;"}